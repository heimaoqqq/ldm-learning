# FIDä¼˜åŒ–ä¸“ç”¨é…ç½® - ç›®æ ‡FID < 20
# é’ˆå¯¹æ­¥æ€çƒ­åŠ›å›¾æ•°æ®çš„æ·±åº¦ä¼˜åŒ–ç‰ˆæœ¬

# VAE ç›¸å…³é…ç½® (ä½¿ç”¨é¢„è®­ç»ƒçš„VQ-VAE)
vae:
  model_path: "/kaggle/input/vae-best-fid/adv_vqvae_best_fid.pth"
  in_channels: 3
  latent_dim: 256
  num_embeddings: 512
  beta: 0.25
  vq_ema_decay: 0.99
  groups: 32
  freeze: true
  # VAEè¾“å‡ºä¿¡æ¯
  latent_height: 32
  latent_width: 32
  latent_channels: 256

# æ•°æ®é›†é…ç½® - FIDä¼˜åŒ–
dataset:
  root_dir: "/kaggle/input/dataset"
  batch_size: 16  # ğŸ¯ é™ä½batch sizeï¼Œä¸“æ³¨è´¨é‡
  num_workers: 6
  val_split: 0.2
  image_size: 256

# æ‰©æ•£æ¨¡å‹é…ç½® - é«˜è´¨é‡è®¾ç½®
diffusion:
  timesteps: 1000
  noise_schedule: "scaled_linear"
  beta_start: 0.00085
  beta_end: 0.012
  scheduler_type: "ddim"
  clip_denoised: true
  prediction_type: "epsilon"

# U-Net ç½‘ç»œç»“æ„é…ç½® - å¼ºåŒ–ç‰ˆ
unet:
  # è¾“å…¥è¾“å‡ºç»´åº¦
  in_channels: 256
  out_channels: 256
  
  # ğŸ¯ å¤§æ¨¡å‹é…ç½® - ä¸“æ³¨å›¾åƒè´¨é‡
  model_channels: 320  # ğŸš€ æ¥è¿‘å®Œæ•´SDè§„æ¨¡
  num_res_blocks: 4    # ğŸš€ å¢åŠ ResNetå—æ·±åº¦
  attention_resolutions: [16, 8, 4, 2, 1]  # ğŸš€ å…¨å°ºåº¦æ³¨æ„åŠ›
  channel_mult: [1, 2, 4, 6, 8]  # ğŸš€ æ›´æ·±çš„é€šé“å±‚æ¬¡
  
  # å¼ºåŒ–æ³¨æ„åŠ›é…ç½®
  num_head_channels: 80  # ğŸš€ å¢å¤§æ³¨æ„åŠ›å¤´
  use_spatial_transformer: true
  transformer_depth: 3   # ğŸš€ ä¸‰å±‚transformer
  
  # æ¡ä»¶åµŒå…¥
  num_classes: 31
  use_fp16: false  # ğŸ¯ ä½¿ç”¨FP32æé«˜ç²¾åº¦
  
  # æ—¶é—´åµŒå…¥
  time_embed_dim: 1280  # 320 * 4

# è®­ç»ƒé…ç½® - é«˜è´¨é‡è®­ç»ƒ
training:
  epochs: 600  # ğŸ¯ å¤§å¹…å¢åŠ è®­ç»ƒè½®æ•°
  lr: 0.0001   # ğŸš€ æé«˜å­¦ä¹ ç‡ï¼š0.00005->0.0001
  weight_decay: 0.02  # ğŸš€ å¢åŠ æ­£åˆ™åŒ–ï¼š0.01->0.02
  warmup_steps: 5000  # ğŸ¯ æ›´é•¿warmup
  
  # æ¢¯åº¦ç´¯ç§¯ - å¤§æ¨¡å‹è®­ç»ƒ
  gradient_accumulation_steps: 4  # ğŸ¯ ç´¯ç§¯æ¢¯åº¦ç­‰æ•ˆbatch64
  
  # æ—©åœç­–ç•¥
  early_stopping_patience: 50  # ğŸš€ æ–°å¢ï¼š50ä¸ªepochæ— æ”¹å–„åˆ™åœæ­¢
  early_stopping_metric: "fid"  # ğŸš€ åŸºäºFIDå€¼æ—©åœ
  
  # ä¿å­˜è®¾ç½®
  save_dir: "fid_optimized_models"
  save_interval: 50
  sample_interval: 25  # ğŸ¯ æ›´é¢‘ç¹ç”Ÿæˆæ ·æœ¬ç›‘æ§
  log_interval: 20
  
  # æŸå¤±é…ç½® - æ··åˆæŸå¤±
  loss_type: "l2"
  
  # Classifier-Free Guidance - å¼ºåŒ–
  use_cfg: true
  cfg_dropout_prob: 0.15  # ğŸš€ ç¨å¾®å¢åŠ dropoutï¼š0.1->0.15
  
  # ä¼˜åŒ–å™¨é…ç½®
  optimizer: "adamw"
  beta1: 0.9
  beta2: 0.999
  eps: 1e-8
  
  # æ¢¯åº¦è£å‰ª
  grad_clip_norm: 0.5  # ğŸ¯ æ›´ä¸¥æ ¼çš„æ¢¯åº¦è£å‰ª
  
  # è°ƒåº¦å™¨
  use_scheduler: true
  scheduler_type: "cosine"

# FIDè¯„ä¼°é…ç½® - é«˜ç²¾åº¦è¯„ä¼°
fid_evaluation:
  enabled: true
  eval_interval: 25         # ğŸš€ æé«˜è¯„ä¼°é¢‘ç‡ï¼š50->25 epoch
  num_samples: 2000         # ğŸš€ å¢åŠ æ ·æœ¬æ•°ï¼š1000->2000
  batch_size: 32            # ä¿æŒä¸å˜
  max_real_samples: 2000    # ğŸš€ å¢åŠ çœŸå®æ ·æœ¬æ•°ï¼š1000->2000
  save_best_fid_model: true

# æ¨ç†é…ç½® - é«˜è´¨é‡é‡‡æ ·
inference:
  num_inference_steps: 75   # ğŸš€ å¢åŠ é‡‡æ ·æ­¥æ•°ï¼š50->75
  guidance_scale: 8.5       # ğŸš€ ç¨å¾®æé«˜CFGï¼š7.5->8.5  
  eta: 0.3                  # ğŸš€ æ·»åŠ é€‚é‡éšæœºæ€§ï¼š0.0->0.3
  
  # é‡‡æ ·é…ç½®
  sample_batch_size: 8
  num_samples_per_class: 10
  
  # è¾“å‡ºè®¾ç½®
  output_dir: "fid_optimized_samples"
  save_format: "png"

# è®¾å¤‡é…ç½®
device: "auto"
mixed_precision: false  # ğŸ¯ ç¦ç”¨æ··åˆç²¾åº¦ï¼Œè¿½æ±‚è´¨é‡
use_ema: true
ema_decay: 0.9999

# æ—¥å¿—é…ç½®
logging:
  use_wandb: false
  project_name: "SD-LDM-FID-Optimized"
  experiment_name: "fid_target_20"
  log_dir: "fid_logs" 
